<?php


function ifa_on_installation()
{
	global $wpdb;
	$table_name = $wpdb->prefix . 'order_queue';

	//------------------------------------------------------------------------
	//--------------------------------log-------------------------------------
	//------------------------------------------------------------------------
	if (__IFA_DEBUG__=='TRUE') {
		error_log("<pre>ifa_on_installation $table_name</pre>");
	}
	//------------------------------------------------------------------------
	//------------------------------------------------------------------------

	$charset_collate = $wpdb->get_charset_collate();

	$sql = "CREATE TABLE $table_name (
        id mediumint(9) NOT NULL AUTO_INCREMENT,
        order_id bigint(20) NOT NULL,
        order_data longtext NOT NULL,
        retries int(11) DEFAULT 0,
        status varchar(20) DEFAULT 'pending',
        created_at datetime DEFAULT CURRENT_TIMESTAMP NOT NULL,
        PRIMARY KEY (id)
    ) $charset_collate;";


	//------------------------------------------------------------------------
	//--------------------------------log-------------------------------------
	//------------------------------------------------------------------------
	if (__IFA_DEBUG__=='TRUE') {
		error_log("<pre>ifa_on_installation sql $sql</pre>");
	}
	//------------------------------------------------------------------------
	//------------------------------------------------------------------------


	require_once(ABSPATH . 'wp-admin/includes/upgrade.php');

	//------------------------------------------------------------------------
	//--------------------------------log-------------------------------------
	//------------------------------------------------------------------------
	if (__IFA_DEBUG__=='TRUE') {
		error_log("<pre>ifa_on_installation require_once ABSPATH . 'wp-admin/includes/upgrade.php'</pre>");
	}
	//------------------------------------------------------------------------
	//------------------------------------------------------------------------


	dbDelta($sql);



	//------------------------------------------------------------------------
	//--------------------------------log-------------------------------------
	//------------------------------------------------------------------------
	if (__IFA_DEBUG__=='TRUE') {
		error_log("<pre>ifa_on_installation done</pre>");
	}
	//------------------------------------------------------------------------
	//------------------------------------------------------------------------

}


?>
